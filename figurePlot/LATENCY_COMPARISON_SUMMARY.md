# 时延比较图 - 文件清单与使用说明

## 📁 已创建的文件

### 1. 主脚本
- **文件**: `plot_latency_comparison.py`
- **功能**: 生成四种方法的时延对比图
- **输出**: `figures/latency_comparison_4methods.png`

### 2. 运行脚本
- **文件**: `run_latency_comparison.bat`
- **功能**: Windows批处理文件，一键运行时延比较分析

### 3. 文档
- **文件**: `README_LATENCY_COMPARISON.md`
- **内容**: 详细的使用说明、配置指南和故障排除

## 🎯 对比的四种方法

| 方法 | 说明 | 配色 | 数据路径 |
|------|------|------|----------|
| **PID** | PID控制器方法 | 蓝色 (#3498DB) | `expTest_PID/` |
| **Lagrangian** | 拉格朗日优化方法 | 红色 (#E74C3C) | `expTest_Lagrangian/` |
| **RB** | 基准方法 (R=E(f_B)) | 橙色 (#F39C12) | `expTest_R_EB/` |
| **Monoxide** | Monoxide基准 | 绿色 (#27AE60) | `expTest_monoxide/` |

## 📊 生成的图表内容

生成的图表包含 **4个子图**，布局为 2×2：

```
┌─────────────────────────┬─────────────────────────┐
│  1. CTX平均时延柱状图    │  2. CTX/ITX时延比率     │
│     (Bar Chart)         │     (Bar Chart)         │
├─────────────────────────┼─────────────────────────┤
│  3. CTX时延分布箱线图    │  4. 多指标分组对比      │
│     (Boxplot)           │     (Grouped Bar)       │
└─────────────────────────┴─────────────────────────┘
```

### 子图详细说明

#### 图1: CTX平均时延柱状图
- 直观对比各方法的CTX平均时延
- 柱子上方显示具体数值
- 使用各方法的专属配色

#### 图2: CTX/ITX时延比率
- 显示跨片交易相对片内交易的时延比率
- 包含公平线 (ratio = 1.0)
- 标注具体比率值 (如 "1.45x")

#### 图3: CTX时延分布箱线图
- 展示各方法时延的完整分布
- 包含中位数、四分位数、异常值
- 红色菱形标记表示平均值

#### 图4: 多指标分组对比
- 同时对比三个关键指标：
  - 平均值 (Mean)
  - 中位数 (Median)
  - 95分位数 (95th Percentile)
- 分组柱状图便于横向对比

## 🚀 快速开始

### 步骤1: 确保数据存在

检查以下目录是否包含 `Tx_Details.csv` 文件：
```
expTest_PID/result/supervisor_measureOutput/
expTest_Lagrangian/result/supervisor_measureOutput/
expTest_R_EB/result/supervisor_measureOutput/
expTest_monoxide/result/supervisor_measureOutput/
```

### 步骤2: 运行脚本

**Windows用户** (推荐):
```bash
run_latency_comparison.bat
```

**所有平台**:
```bash
python plot_latency_comparison.py
```

### 步骤3: 查看结果

生成的图表保存在：
```
figures/latency_comparison_4methods.png
```

## 📈 输出示例

### 控制台输出

```
============================================================
Justitia 时延比较图生成器
PID vs Lagrangian vs RB vs Monoxide
============================================================

正在加载 PID 数据...
✓ 成功加载 PID 数据: 25000 条记录

正在加载 Lagrangian 数据...
✓ 成功加载 Lagrangian 数据: 25000 条记录

====================================================================================================
时延统计对比表
====================================================================================================

方法              CTX平均(ms)     CTX中位数(ms)   CTX标准差(ms)   时延比率         评级           
----------------------------------------------------------------------------------------------------
PID             15234.56        14500.00        3245.67         1.45            🟢 优秀        
Lagrangian      18567.89        17800.00        4123.45         1.78            🟡 良好        
RB              25678.90        24500.00        5678.90         2.45            🟠 一般        
Monoxide        32456.78        31200.00        6789.01         3.12            🔴 较差        

✓ 图表已保存: figures\latency_comparison_4methods.png
```

## 🔧 代码特点

### 1. 模块化设计
- `load_experiment_data()`: 加载实验数据
- `classify_transactions()`: 分类CTX和ITX
- `extract_latency_metrics()`: 提取时延指标
- `plot_latency_comparison()`: 绘制对比图表
- `print_statistics_table()`: 打印统计表格

### 2. 鲁棒性
- 自动检测数据文件是否存在
- 缺失数据时给出清晰提示
- 支持部分数据生成图表

### 3. 可扩展性
- 易于添加新的对比方法
- 配色方案集中管理
- 路径配置统一定义

### 4. 专业输出
- 高分辨率 (300 DPI)
- 统一的视觉风格
- 清晰的标签和图例

## 📋 与现有代码的一致性

该脚本参考了以下现有文件的风格：
- `plot_fig1_boxplot.py`: 箱线图绘制风格
- `plot_fig2_ratio.py`: 柱状图和比率展示
- `compare_all_modes.py`: 多方法对比框架

保持了以下一致性：
- ✅ 相同的配色方案
- ✅ 相同的绘图参数设置
- ✅ 相同的输出目录结构
- ✅ 相同的错误处理方式
- ✅ 相同的中文支持配置

## 🎨 配色方案说明

```python
COLORS = {
    'PID': '#3498DB',           # 蓝色 - 代表稳定控制
    'Lagrangian': '#E74C3C',    # 红色 - 代表优化算法
    'RB': '#F39C12',            # 橙色 - 代表基准方法 (R=E(f_B))
    'Monoxide': '#27AE60'       # 绿色 - 代表对比基准
}
```

这些颜色：
- 色彩对比度高，易于区分
- 符合学术论文配色规范
- 打印成黑白时仍可区分

## 💡 使用建议

### 论文使用
1. 生成的PNG图片可直接用于论文
2. 300 DPI分辨率满足大多数期刊要求
3. 如需矢量图，可修改保存格式为PDF或SVG

### 演示使用
1. 图表布局清晰，适合PPT展示
2. 配色鲜明，投影效果好
3. 数值标注清楚，便于讲解

### 报告使用
1. 控制台输出的表格可直接复制
2. 评级系统便于快速评估
3. 统计数据完整，支持深入分析

## 🔍 进阶使用

### 修改图表布局

如需调整子图布局，修改 `plot_latency_comparison()` 函数中的：
```python
gs = fig.add_gridspec(2, 2, hspace=0.3, wspace=0.3)
```

### 添加新的对比方法

1. 在 `EXPERIMENT_PATHS` 中添加路径
2. 在 `COLORS` 中添加配色
3. 在 `main()` 函数的循环中添加方法名

### 自定义评级标准

修改 `print_statistics_table()` 函数中的评级逻辑：
```python
if ratio < 1.5:
    rating = "🟢 优秀"
elif ratio < 2.0:
    rating = "🟡 良好"
# ... 可自定义阈值
```

## 📞 技术支持

如遇问题，请检查：
1. Python版本 (建议 3.7+)
2. 依赖包是否完整安装
3. 数据文件路径是否正确
4. CSV文件格式是否符合预期

## ✨ 总结

该时延比较图工具提供了：
- ✅ 完整的四方法对比
- ✅ 多维度的时延分析
- ✅ 专业的可视化输出
- ✅ 详细的统计信息
- ✅ 简单的使用方式

适用于学术研究、性能评估和系统优化等场景。
